name: test

on:
  push:

jobs:
  build:
    runs-on: macos-12

    steps:
      - name: Debug
        run: |
          export
          echo $PATH |
            tr ':' '\n' |
            while read p; do
              echo $p
              find $p -type l -print0 |
                xargs -0 ls -halw
            done

      - name: Shim
        run: |
          for package in go python@3.11; do
              if brew info "$package" | grep -q ^/; then
                  brew link --overwrite "$package"
              fi
          done

      - name: Brew
        run: |
          brew update
          brew upgrade

      - name: Debug
        run: |
          export
          echo $PATH |
            tr ':' '\n' |
            while read p; do
              echo $p
              find $p -type l -print0 |
                xargs -0 ls -halw
            done
